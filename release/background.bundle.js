var Yt=Object.defineProperty,Ft=Object.defineProperties;var Gt=Object.getOwnPropertyDescriptors;var qe=Object.getOwnPropertySymbols;var Xt=Object.prototype.hasOwnProperty,Jt=Object.prototype.propertyIsEnumerable;var et=(L,I,w)=>I in L?Yt(L,I,{enumerable:!0,configurable:!0,writable:!0,value:w}):L[I]=w,tt=(L,I)=>{for(var w in I||(I={}))Xt.call(I,w)&&et(L,w,I[w]);if(qe)for(var w of qe(I))Jt.call(I,w)&&et(L,w,I[w]);return L},nt=(L,I)=>Ft(L,Gt(I));var rt=(L,I,w)=>new Promise((we,K)=>{var U=P=>{try{x(w.next(P))}catch($){K($)}},k=P=>{try{x(w.throw(P))}catch($){K($)}},x=P=>P.done?we(P.value):Promise.resolve(P.value).then(U,k);x((w=w.apply(L,I)).next())});(()=>{var L={27484:function(K){(function(U,k){K.exports=k()})(this,function(){"use strict";var U="millisecond",k="second",x="minute",P="hour",$="day",Q="week",R="month",se="quarter",j="year",Y="date",de=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,oe=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},X=function(d,c,s){var f=String(d);return!f||f.length>=c?d:""+Array(c+1-f.length).join(s)+d},ie={s:X,z:function(d){var c=-d.utcOffset(),s=Math.abs(c),f=Math.floor(s/60),a=s%60;return(c<=0?"+":"-")+X(f,2,"0")+":"+X(a,2,"0")},m:function d(c,s){if(c.date()<s.date())return-d(s,c);var f=12*(s.year()-c.year())+(s.month()-c.month()),a=c.clone().add(f,R),p=s-a<0,h=c.clone().add(f+(p?-1:1),R);return+(-(f+(s-a)/(p?a-h:h-a))||0)},a:function(d){return d<0?Math.ceil(d)||0:Math.floor(d)},p:function(d){return{M:R,y:j,w:Q,d:$,D:Y,h:P,m:x,s:k,ms:U,Q:se}[d]||String(d||"").toLowerCase().replace(/s$/,"")},u:function(d){return d===void 0}},J="en",N={};N[J]=le;var z=function(d){return d instanceof A},q=function(d,c,s){var f;if(!d)return J;if(typeof d=="string")N[d]&&(f=d),c&&(N[d]=c,f=d);else{var a=d.name;N[a]=d,f=a}return!s&&f&&(J=f),f||!s&&J},b=function(d,c){if(z(d))return d.clone();var s=typeof c=="object"?c:{};return s.date=d,s.args=arguments,new A(s)},v=ie;v.l=q,v.i=z,v.w=function(d,c){return b(d,{locale:c.$L,utc:c.$u,x:c.$x,$offset:c.$offset})};var A=function(){function d(s){this.$L=q(s.locale,null,!0),this.parse(s)}var c=d.prototype;return c.parse=function(s){this.$d=function(f){var a=f.date,p=f.utc;if(a===null)return new Date(NaN);if(v.u(a))return new Date;if(a instanceof Date)return new Date(a);if(typeof a=="string"&&!/Z$/i.test(a)){var h=a.match(de);if(h){var m=h[2]-1||0,S=(h[7]||"0").substring(0,3);return p?new Date(Date.UTC(h[1],m,h[3]||1,h[4]||0,h[5]||0,h[6]||0,S)):new Date(h[1],m,h[3]||1,h[4]||0,h[5]||0,h[6]||0,S)}}return new Date(a)}(s),this.$x=s.x||{},this.init()},c.init=function(){var s=this.$d;this.$y=s.getFullYear(),this.$M=s.getMonth(),this.$D=s.getDate(),this.$W=s.getDay(),this.$H=s.getHours(),this.$m=s.getMinutes(),this.$s=s.getSeconds(),this.$ms=s.getMilliseconds()},c.$utils=function(){return v},c.isValid=function(){return this.$d.toString()!=="Invalid Date"},c.isSame=function(s,f){var a=b(s);return this.startOf(f)<=a&&a<=this.endOf(f)},c.isAfter=function(s,f){return b(s)<this.startOf(f)},c.isBefore=function(s,f){return this.endOf(f)<b(s)},c.$g=function(s,f,a){return v.u(s)?this[f]:this.set(a,s)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(s,f){var a=this,p=!!v.u(f)||f,h=v.p(s),m=function(F,D){var H=v.w(a.$u?Date.UTC(a.$y,D,F):new Date(a.$y,D,F),a);return p?H:H.endOf($)},S=function(F,D){return v.w(a.toDate()[F].apply(a.toDate("s"),(p?[0,0,0,0]:[23,59,59,999]).slice(D)),a)},_=this.$W,M=this.$M,W=this.$D,T="set"+(this.$u?"UTC":"");switch(h){case j:return p?m(1,0):m(31,11);case R:return p?m(1,M):m(0,M+1);case Q:var B=this.$locale().weekStart||0,te=(_<B?_+7:_)-B;return m(p?W-te:W+(6-te),M);case $:case Y:return S(T+"Hours",0);case P:return S(T+"Minutes",1);case x:return S(T+"Seconds",2);case k:return S(T+"Milliseconds",3);default:return this.clone()}},c.endOf=function(s){return this.startOf(s,!1)},c.$set=function(s,f){var a,p=v.p(s),h="set"+(this.$u?"UTC":""),m=(a={},a[$]=h+"Date",a[Y]=h+"Date",a[R]=h+"Month",a[j]=h+"FullYear",a[P]=h+"Hours",a[x]=h+"Minutes",a[k]=h+"Seconds",a[U]=h+"Milliseconds",a)[p],S=p===$?this.$D+(f-this.$W):f;if(p===R||p===j){var _=this.clone().set(Y,1);_.$d[m](S),_.init(),this.$d=_.set(Y,Math.min(this.$D,_.daysInMonth())).$d}else m&&this.$d[m](S);return this.init(),this},c.set=function(s,f){return this.clone().$set(s,f)},c.get=function(s){return this[v.p(s)]()},c.add=function(s,f){var a,p=this;s=Number(s);var h=v.p(f),m=function(M){var W=b(p);return v.w(W.date(W.date()+Math.round(M*s)),p)};if(h===R)return this.set(R,this.$M+s);if(h===j)return this.set(j,this.$y+s);if(h===$)return m(1);if(h===Q)return m(7);var S=(a={},a[x]=6e4,a[P]=36e5,a[k]=1e3,a)[h]||1,_=this.$d.getTime()+s*S;return v.w(_,this)},c.subtract=function(s,f){return this.add(-1*s,f)},c.format=function(s){var f=this;if(!this.isValid())return"Invalid Date";var a=s||"YYYY-MM-DDTHH:mm:ssZ",p=v.z(this),h=this.$locale(),m=this.$H,S=this.$m,_=this.$M,M=h.weekdays,W=h.months,T=function(D,H,ae,ne){return D&&(D[H]||D(f,a))||ae[H].substr(0,ne)},B=function(D){return v.s(m%12||12,D,"0")},te=h.meridiem||function(D,H,ae){var ne=D<12?"AM":"PM";return ae?ne.toLowerCase():ne},F={YY:String(this.$y).slice(-2),YYYY:this.$y,M:_+1,MM:v.s(_+1,2,"0"),MMM:T(h.monthsShort,_,W,3),MMMM:T(W,_),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:T(h.weekdaysMin,this.$W,M,2),ddd:T(h.weekdaysShort,this.$W,M,3),dddd:M[this.$W],H:String(m),HH:v.s(m,2,"0"),h:B(1),hh:B(2),a:te(m,S,!0),A:te(m,S,!1),m:String(S),mm:v.s(S,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:p};return a.replace(oe,function(D,H){return H||F[D]||p.replace(":","")})},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(s,f,a){var p,h=v.p(f),m=b(s),S=6e4*(m.utcOffset()-this.utcOffset()),_=this-m,M=v.m(this,m);return M=(p={},p[j]=M/12,p[R]=M,p[se]=M/3,p[Q]=(_-S)/6048e5,p[$]=(_-S)/864e5,p[P]=_/36e5,p[x]=_/6e4,p[k]=_/1e3,p)[h]||_,a?M:v.a(M)},c.daysInMonth=function(){return this.endOf(R).$D},c.$locale=function(){return N[this.$L]},c.locale=function(s,f){if(!s)return this.$L;var a=this.clone(),p=q(s,f,!0);return p&&(a.$L=p),a},c.clone=function(){return v.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},d}(),ee=A.prototype;return b.prototype=ee,[["$ms",U],["$s",k],["$m",x],["$H",P],["$W",$],["$M",R],["$y",j],["$D",Y]].forEach(function(d){ee[d[1]]=function(c){return this.$g(c,d[0],d[1])}}),b.extend=function(d,c){return d.$i||(d(c,A,b),d.$i=!0),b},b.locale=q,b.isDayjs=z,b.unix=function(d){return b(1e3*d)},b.en=N[J],b.Ls=N,b.p={},b})}},I={};function w(K){var U=I[K];if(U!==void 0)return U.exports;var k=I[K]={exports:{}};return L[K].call(k.exports,k,k.exports,w),k.exports}(()=>{w.p="/"})();var we={};(()=>{"use strict";const K=w.p+"icon-34.png",U=w.p+"icon-128.png";function k(e){for(var t=5381,n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t}const x=k,$=(e,t)=>{const n=x(e);return Math.ceil(Math.abs(Math.sin(n))*t)},Q=(e,t)=>t.some(n=>e instanceof n);let R,se;function j(){return R||(R=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Y(){return se||(se=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const de=new WeakMap,oe=new WeakMap,le=new WeakMap,X=new WeakMap,ie=new WeakMap;function J(e){const t=new Promise((n,i)=>{const o=()=>{e.removeEventListener("success",l),e.removeEventListener("error",y)},l=()=>{n(A(e.result)),o()},y=()=>{i(e.error),o()};e.addEventListener("success",l),e.addEventListener("error",y)});return t.then(n=>{n instanceof IDBCursor&&de.set(n,e)}).catch(()=>{}),ie.set(t,e),t}function N(e){if(oe.has(e))return;const t=new Promise((n,i)=>{const o=()=>{e.removeEventListener("complete",l),e.removeEventListener("error",y),e.removeEventListener("abort",y)},l=()=>{n(),o()},y=()=>{i(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",l),e.addEventListener("error",y),e.addEventListener("abort",y)});oe.set(e,t)}let z={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return oe.get(e);if(t==="objectStoreNames")return e.objectStoreNames||le.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return A(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function q(e){z=e(z)}function b(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(ee(this),t,...n);return le.set(i,t.sort?t.sort():[t]),A(i)}:Y().includes(e)?function(...t){return e.apply(ee(this),t),A(de.get(this))}:function(...t){return A(e.apply(ee(this),t))}}function v(e){return typeof e=="function"?b(e):(e instanceof IDBTransaction&&N(e),Q(e,j())?new Proxy(e,z):e)}function A(e){if(e instanceof IDBRequest)return J(e);if(X.has(e))return X.get(e);const t=v(e);return t!==e&&(X.set(e,t),ie.set(t,e)),t}const ee=e=>ie.get(e);function d(e,t,{blocked:n,upgrade:i,blocking:o,terminated:l}={}){const y=indexedDB.open(e,t),u=A(y);return i&&y.addEventListener("upgradeneeded",r=>{i(A(y.result),r.oldVersion,r.newVersion,A(y.transaction))}),n&&y.addEventListener("blocked",()=>n()),u.then(r=>{l&&r.addEventListener("close",()=>l()),o&&r.addEventListener("versionchange",()=>o())}).catch(()=>{}),u}function c(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),wrap(n).then(()=>{})}const s=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],a=new Map;function p(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(a.get(t))return a.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,o=f.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(o||s.includes(n)))return;const l=function(y,...u){return rt(this,null,function*(){const r=this.transaction(y,o?"readwrite":"readonly");let g=r.store;return i&&(g=g.index(u.shift())),(yield Promise.all([g[n](...u),o&&r.done]))[0]})};return a.set(t,l),l}q(e=>nt(tt({},e),{get:(t,n,i)=>p(t,n)||e.get(t,n,i),has:(t,n)=>!!p(t,n)||e.has(t,n)}));const h="fokus-db",m="store-websites",S="store-tasks",_="store-task-history",M="store-task-history-now",W="store-debug",T="store-various",B="various_default",te=()=>({items:[],count:0,hasNext:!1});function F(){return{[m]:{id:"",title:"",description:"",urlRegex:"",urlMode:"URL_MODE_TEXT"},[S]:{id:"",title:"",emojiId:"",description:"",blockedSiteIds:[],allowedSiteIds:[],blockMode:"BLOCK_MODE_ALLOW_ALL",maxDuration:-1},[_]:{id:"",timeStart:0,timeEnd:0,taskId:""},[T]:{id:B,debug:!1,nowTaskId:"",nowTaskHistoryId:""}}}const D=F;var H=Object.defineProperty,ae=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,be=(e,t,n)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,De=(e,t)=>{for(var n in t||(t={}))st.call(t,n)&&be(e,n,t[n]);if(Ee)for(var n of Ee(t))ot.call(t,n)&&be(e,n,t[n]);return e},Ie=(e,t)=>ae(e,ne(t)),ke=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const Me=(()=>{let e=null;const t=1,n={upgrade(l){l.createObjectStore(m,{keyPath:"id"}),l.createObjectStore(S,{keyPath:"id"}),l.createObjectStore(_,{keyPath:"id"}).createIndex("byTimeStart",["timeStart","id"]),l.createObjectStore(T,{keyPath:"id"})}};return{setDebugMode:l=>ke(void 0,null,function*(){e||(e=yield d(h,t,n));const y=yield e.get(T,B);if(!y){yield e.add(T,Ie(De({},D()[T]),{debug:l}));return}yield e.put(T,Ie(De({},y),{debug:l}))}),getDebugMode:()=>ke(void 0,null,function*(){e||(e=yield d(h,t,n));const l=yield e.get(T,B);return l?l.debug:D()[T].debug})}})(),Zt=Me.setDebugMode,it=Me.getDebugMode,Qt=null;var at=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const Pe=["#264653","#2a9d8f","#e9c46a","#f4a261","#e76f51","#606c38"],$e=(e,t=!1)=>{const n=$(e,Pe.length),o=`color: ${Pe[n]};`;return(...l)=>at(void 0,null,function*(){if(!(!(yield it())&&t===!1))return console.log(`%c${e}:`,o,...l)})},ct="blocked-url",en="google",ut=6e4,tn="revalidate",nn="show-modal",rn="hide-modal",dt="BLOCK_MODE_BLOCK_ALL",lt="BLOCK_MODE_ALLOW_ALL",sn="MSG_CHANGE_COLOR",on="DEFAULT_PORT",ft="EXPORT_SETTINGS";var re=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const ce=$e("storage"),V=(()=>{let e=null,t=()=>{};const n=1,i={upgrade(O){O.createObjectStore(m,{keyPath:"id"}),O.createObjectStore(S,{keyPath:"id"}),O.createObjectStore(_,{keyPath:"id"}).createIndex("byTimeStart",["timeStart","id"]),O.createObjectStore(T,{keyPath:"id"})}},o=()=>re(void 0,null,function*(){return e||(e=yield d(h,n,i)),e});function l(O,E){return re(this,null,function*(){e||(e=yield o()),ce(`set(${O})`,E),t(),yield e.transaction(O,"readwrite").store.put(E)})}function y(O,E){return re(this,null,function*(){e||(e=yield o()),ce(`add(${O})`,E),t();const C=e.transaction(O,"readwrite");yield C.store.add(E),yield C.done})}function u(O,E){return re(this,null,function*(){e||(e=yield d(h,n,i));const C=yield e.get(O,E);if(ce(`get(${O}, ${E})`,C),C===void 0){const ye=D();return ce(`get(${E}) return default`,D()[O]),ye[O]}return ce(`get(${E}) return`,C),C})}function r(O,E,C,ye){return re(this,null,function*(){e||(e=yield o());const Te=e.transaction(O,"readwrite");let Z=yield Te.store.openCursor(C);if(O===_){const Qe="byTimeStart";Z=yield Te.store.index(Qe).openCursor(IDBKeyRange.lowerBound([0,C||""],!0))}let ze=0,Ze=[];for(;ze<E&&Z;){(typeof ye=="function"?ye(Z.value):!0)&&(Ze.push(Z.value),ze+=1);try{Z=yield Z.continue()}catch(Cn){break}}const Nt=!!Z,Wt=yield Te.store.count();return{items:Ze,count:Wt,hasNext:Nt}})}function g(O,E){return re(this,null,function*(){e||(e=yield o()),yield e.delete(O,E)})}function ue(O){t=O}return{add:y,set:l,get:u,getAll:r,remove:g,onChange:ue,getDB:o}})(),ge="production",cn=ge==="development",un=ge==="production",ht=ge==="test",dn=({}.CYPRESS_MODE||"").toLowerCase()==="true",Re=e=>{let t=ht?"chrome:extension":chrome.runtime.getURL("options.html");if(e){const n=Object.entries(e).map(([i,o])=>[i,o].join("=")).join("&");t=[t,n].join("?")}return t},yt=e=>new RegExp("^chrome.*://","i").test(e),gt="URL_MODE_TEXT",pt="URL_MODE_REGEX",mt="URL_MODE_REGEX_IGNORE_PROTOCOL",Le=(e,t,n)=>{if(e===gt)return n.includes(t);try{if(e===pt)return new RegExp(t,"i").test(n);if(e===mt){const i=(n||"").replace(/^\/\/|^.*?:(\/\/)?/,"");return new RegExp(t,"i").test(i)}}catch(i){return!1}},fe=()=>new Date().getTime();var pe=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const me=e=>pe(void 0,null,function*(){return(yield V.get(T,B))[e]}),gn=(e,t)=>pe(void 0,null,function*(){const n=yield storage.get(STORE_VARIOUS,STORE_VARIOUS_KEY);return n[e]=t,yield storage.set(STORE_VARIOUS,n),n}),pn=()=>storage.get(STORE_VARIOUS,STORE_VARIOUS_KEY),mn=e=>pe(void 0,null,function*(){return yield storage.set(STORE_VARIOUS,e),e});var _n=w(27484);const vn=e=>{const t=dayjs(e),n=t.hour();return{year:t.year(),month:t.month()+1,day:t.date(),hour24:n,minute:t.minute(),hour:n>12?n-12:n,noon:n>12,dayjs:t}},On=null;var _t=Object.defineProperty,vt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,St=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,xe=(e,t,n)=>t in e?_t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Be=(e,t)=>{for(var n in t||(t={}))St.call(t,n)&&xe(e,n,t[n]);if(Ae)for(var n of Ae(t))Tt.call(t,n)&&xe(e,n,t[n]);return e},Ce=(e,t)=>vt(e,Ot(t)),wt=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const Et=({size:e=Infinity,cursorId:t,searchFunc:n}={})=>storage.getAll(STORE_TASKS,e,t,n),Sn=e=>{const t=n=>new RegExp(e,"i").test(n.title);return{getAll:n=>Et(Ce(Be({},n||{}),{searchFunc:t}))}},Ue=e=>V.get(S,e),Tn=e=>{const t=makeId(),n=Ce(Be({},e),{id:t});return storage.add(STORE_TASKS,n)},wn=e=>storage.remove(STORE_TASKS,e),En=e=>wt(void 0,null,function*(){return yield storage.set(STORE_TASKS,e),e});var bt=Object.defineProperty,Dt=Object.defineProperties,It=Object.getOwnPropertyDescriptors,je=Object.getOwnPropertySymbols,kt=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable,He=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_e=(e,t)=>{for(var n in t||(t={}))kt.call(t,n)&&He(e,n,t[n]);if(je)for(var n of je(t))Mt.call(t,n)&&He(e,n,t[n]);return e},ve=(e,t)=>Dt(e,It(t)),Ve=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const Pt=e=>V.get(_,e),Ke=({size:e=Infinity,cursorId:t,searchFunc:n}={})=>storage.getAll(STORE_TASK_HISTORY,e,t,n),bn=(e,t,n=!0)=>{const i=o=>o.timeStart===-1&&!n?!1:o.timeStart>e&&o.timeStart<t;return{getAll:o=>Ke(ve(_e({},o||{}),{searchFunc:i}))}},Dn=e=>{const t=n=>n.taskId===e;return{getAll:n=>Ke(ve(_e({},n||{}),{searchFunc:t}))}},In=e=>storage.remove(STORE_TASK_HISTORY,e),kn=e=>Ve(void 0,null,function*(){const t=makeId(),n={id:t,timeStart:getTime(),timeEnd:-1,taskId:e},i=yield storage.get(STORE_VARIOUS,STORE_VARIOUS_KEY),o=i.nowTaskId!=="",l=ve(_e({},i),{nowTaskId:e,nowTaskHistoryId:t});o&&(yield Ne());const y=[storage.add(STORE_TASK_HISTORY,n),storage.set(STORE_VARIOUS,l)];return yield Promise.all(y),{taskHistory:n,various:l}}),Ne=()=>Ve(void 0,null,function*(){const e=yield V.get(T,B),{nowTaskHistoryId:t}=e,n=yield V.get(_,t);n.timeEnd=fe(),e.nowTaskId="",e.nowTaskHistoryId="";const i=[V.set(T,e)];return n.id!==""&&i.push(V.set(_,n)),yield Promise.all(i),e});var $t=Object.defineProperty,Rt=Object.defineProperties,Lt=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,At=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,Ye=(e,t,n)=>t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fe=(e,t)=>{for(var n in t||(t={}))At.call(t,n)&&Ye(e,n,t[n]);if(We)for(var n of We(t))xt.call(t,n)&&Ye(e,n,t[n]);return e},Ge=(e,t)=>Rt(e,Lt(t));const Oe=({size:e=Infinity,cursorId:t,searchFunc:n}={})=>V.getAll(m,e,t,n),Mn=e=>{const t=n=>new RegExp(e,"i").test(n.title);return{getAll:n=>Oe(Ge(Fe({},n||{}),{searchFunc:t}))}},Pn=e=>storage.get(STORE_WEBSITES,e),$n=e=>{const t=makeId(),n=Ge(Fe({},e),{id:t});return storage.add(STORE_WEBSITES,n)},Rn=e=>storage.remove(STORE_WEBSITES,e),Ln=e=>storage.set(STORE_WEBSITES,e),Bt=(e,t)=>{if(!e)throw Error("lib/saveJson - must provide data");const n=new Blob([JSON.stringify(e)],{type:"text/json"}),i=URL.createObjectURL(n);chrome.downloads.download({url:i,filename:t})};var Xe=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const Ct=()=>Xe(void 0,null,function*(){console.log("exportSettings");const e=yield V.getDB(),t={},n=[],i=o=>Xe(this,null,function*(){console.log("exportSettings, accessing store of",o);const l=[];let u=yield e.transaction(o,"readonly").store.openCursor();for(;u;){l.push(u.value);try{u=yield u.continue()}catch(r){break}}t[o]=l});for(const o of e.objectStoreNames)n.push(i(o));return yield Promise.all(n),console.log("exportObj",t),Bt(t,"settings.json"),t});var he=(e,t,n)=>new Promise((i,o)=>{var l=r=>{try{u(n.next(r))}catch(g){o(g)}},y=r=>{try{u(n.throw(r))}catch(g){o(g)}},u=r=>r.done?i(r.value):Promise.resolve(r.value).then(l,y);u((n=n.apply(e,t)).next())});const G=$e("listenFromBackground",!0),Ut=e=>he(void 0,null,function*(){const t=Re();if(e.includes(t)||e==="")return!0;const n=yield me("nowTaskId"),i=yield Ue(n),{blockedSiteIds:o,allowedSiteIds:l,blockMode:y}=i,{items:u}=yield Oe({searchFunc:g=>o.includes(g.id)}),{items:r}=yield Oe({searchFunc:g=>l.includes(g.id)});return G("validateUrl",{url:e,allowedSites:r,blockedSites:u,blockMode:y}),y===lt?u.findIndex(({urlMode:ue,urlRegex:O})=>{const E=Le(ue,O,e);return E===void 0?!1:E})===-1:y===dt?r.findIndex(({urlMode:ue,urlRegex:O})=>{const E=Le(ue,O,e);return E===void 0?!0:E})!==-1:!0}),Je=e=>Re({[ct]:e}),Se=e=>he(void 0,null,function*(){G("onTabUpdate",{tab:e,url:e.url});const t=yield me("nowTaskId"),n=yield me("nowTaskHistoryId");if(!e.url||!e.id||yt(e.url))return;if(t===""){const r=Je(e.url);chrome.tabs.update(e.id,{url:r});return}const i=yield Ut(e.url||""),o=yield Ue(t),y=(yield Pt(n)).timeStart+o.maxDuration*ut;let u=!1;if(o.maxDuration>0&&(u=fe()>y),G("checking",{timeNow:fe(),targetTime:y,isTimeout:u}),!(i&&!u)&&typeof e.id=="number"){u&&Ne();const r=Je(e.url);chrome.tabs.update(e.id,{url:r})}}),jt=()=>he(void 0,null,function*(){G("ticking...",fe()),chrome.tabs.query({},e=>{e.forEach(Se)})}),Ht=()=>{G("storage data changed")},Vt=()=>he(void 0,null,function*(){const e=yield Ct();G("saving storage data",e)}),Kt=()=>{G("listening..."),chrome.runtime.onMessage.addListener(function(e={},t,n){G("onMessage",{message:e,sender:t,reply:n});const{code:i}=e;i===ft&&Vt()}),chrome.tabs.onUpdated.addListener((e,t,n)=>{Se(n)}),chrome.tabs.onCreated.addListener(Se),V.onChange(Ht),setInterval(jt,3e3)};console.log("This is the background page."),console.log("Put the background scripts here."),Kt()})()})();
